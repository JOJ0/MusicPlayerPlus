#!/bin/bash
#
# raise_cava - raise the mppcava window
#

VTITLE="Spectrum Visualizer"
MTITLE="Music Player Plus"

have_xprop=`type -p xprop`
have_wmctrl=`type -p wmctrl`

# Not all window managers implement support for extended window manager hints
if [ "${have_xprop}" ]
then
  have_ewmh=`xprop -root -notype | \
    awk '$1=="_NET_SUPPORTING_WM_CHECK:"{print $5}'`
  [ "${have_ewmh}" ] || exit 1
else
  if [ "${have_wmctrl}" ]
  then
    wmctrl -l > /dev/null 2>&1
    [ $? -eq 0 ] || exit 1
  else
    exit 1
  fi
fi

cavawin=`wmctrl -l -G -x | grep kitty.kitty | grep "${VTITLE}"`
[ "${cavawin}" ] || {
  cavawin=`wmctrl -l -G -x | grep tilix.Tilix | grep "${VTITLE}"`
  [ "${cavawin}" ] || {
    cavawin=`wmctrl -l -G -x | grep gnome-terminal-server | grep "${VTITLE}"`
    [ "${cavawin}" ] || {
      cavawin=`wmctrl -l -G -x | grep kitty.kitty | grep "cava"`
      [ "${cavawin}" ] || {
        cavawin=`wmctrl -l -G -x | grep tilix.Tilix | grep "cava"`
        [ "${cavawin}" ] || {
          cavawin=`wmctrl -l -G -x | grep gnome-terminal-server | grep "cava"`
        }
      }
    }
  }
}
mppwin=`wmctrl -l -G -x | grep kitty.kitty | grep "${MTITLE}"`
[ "${mppwin}" ] || {
  mppwin=`wmctrl -l -G -x | grep tilix.Tilix | grep "${MTITLE}"`
  [ "${mppwin}" ] || {
    mppwin=`wmctrl -l -G -x | grep gnome-terminal-server | grep "${MTITLE}"`
    [ "${mppwin}" ] || {
      mppwin=`wmctrl -l -G -x | grep kitty.kitty | grep "mpcplus"`
      [ "${mppwin}" ] || {
        mppwin=`wmctrl -l -G -x | grep tilix.Tilix | grep "mpcplus"`
        [ "${mppwin}" ] || {
          mppwin=`wmctrl -l -G -x | grep gnome-terminal-server | grep "mpcplus"`
        }
      }
    }
  }
}
[ "${cavawin}" ] && {
  winid=`echo ${cavawin} | awk ' { print $1 } '`
}
[ "${mppwin}" ] && {
  mppid=`echo ${mppwin} | awk ' { print $1 } '`
}
[ "${winid}" ] && [ "${mppid}" ] && {
  above=`xprop -id ${winid} _NET_WM_STATE | grep WM_STATE_ABOVE`
  if [ "${above}" ]
  then
    wmctrl -i -r "${winid}" -b "remove,above"
    wmctrl -i -r "${mppid}" -b "add,above"
  else
    wmctrl -i -r "${mppid}" -b "remove,above"
    wmctrl -i -r "${winid}" -b "add,above"
  fi
}
